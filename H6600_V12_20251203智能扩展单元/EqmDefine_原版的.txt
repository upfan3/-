设备定义文件结构说明
版本 1.0	叶子红	20230912

一、概述
	本文件详细定义了EnergyView软件所用设备定义文件的结构和描述规范，适用eqm文件的编制和使用。
	设备定义文件是EnergyView软件用于描述一种具体的设备或者该设备的一种特定配置形态的文件，可以使EnergyView正确解释设备的数据包并正确显示和处理来自设备的数据。
	设备定义文件的后缀为eqm，以下简称eqm文件。
二、文件格式
	eqm文件是一个文本文件，采用Windows系统的标准文本文件格式和编码。
	eqm文件由若干行文本构成。eqm文件的行分为注释行和描述行两类。
1、注释行
	注释行由VB语言的注释引导符“'”字符开头。EnergyView会自动忽略注释行和空白行。
2、描述行
	描述行是设备定义文件的实际内容。
3、显示字符串
	eqm文件中通常包含大量用于显示的字符串，这些字符串会被EnergyView软件原样显示。
	为了支持多种语言，每个字符串可以同时提供多个语言的版本，并用下划线进行分隔。
	目前支持中文和英文两种语言，中文在前，英文在后。今后可扩展第三种或更多语言，均采用此格式处理。
	以下遇到时将这种字符串称为显示字符串格式。
三、文件结构
	eqm文件按顺序分为四个小节。
1、设备全局说明
	第一个小节为设备全局说明。设备全局说明由若干变量赋值行组成。
	每个变量赋值行由一个变量名及其值组成，中间用等号连接。所有变量的值都是一个字符串。变量名不能出现空格，值字符串的首尾也不包含空格。
	支持的变量名如下：
	Caption	用于显示的设备型号，只能使用英文字母和数字的组合
	Description 用于显示的设备描述，任意可显示的字符串，不能包括“=”。此描述采用显示字符串格式。
	Company	用于显示的公司名称，支持多语言。
	Protocol	采用的通信协议的文件名，不包含后缀。该文件定义了一种通信协议的数据包格式，通常包括首、末标志字段、地址字段、命令码字段、数据字段和校验字段。
	Picture	用于显示的设备图片的文件名。
	VerDate	本文件的版本日期。软件本身不利用该变量，仅供编程者参考。
2、枚举值定义
	第二小节用于定义一系列的枚举值，以便在后面重复引用。
	枚举值定义采用如下格式：
	OPTn=x1:s1|x2:s2|x3:s3
	其中，OPT为固定组合，表示枚举项
		n为十进制序号，用于区分不同的枚举值
		x1为第一个枚举值的数值，可以采用十进制或16进制表示，16进制用H后缀区分
		s1为第一个枚举值的显示字符串，可以是任意可显示字符串，但不得包含“=:|”等符号，以避免冲突。这个字符串采用显示字符串格式。
		枚举值的数值和显示字符串之间用冒号分隔。
		x2、s2分别为第二个枚举值的数值和显示字符串，依次类推。
		多个枚举值之间用“|”竖线符号分隔。
3、设备单元定义
	第三小节用于定义设备单元。
	设备单元定义行由若干个以冒号“:”分隔的字段组成，各字段依次定义如下：
	单元	一个以U开头的单元编码，包含一个以U开头的字符串及其后跟一个十进制序号，供后面的数据项定义引用
	缩写	一个短字符串，用于在内部进行数据分组
	单元显示名	一个显示字符串格式的设备单元名称，该名称将显示在界面中以区分不同的一台设备内的不同设备单元
	CID1	在通信协议中用来识别设备单元的编码，通常为1个字节的整数，用16进制表示，以H结尾
	组号	协议中用于区分多个同类设备单元的编码，采用10进制表示，若系统中仅有一个同类设备单元，这里通常为1。若某种设备单元不支持多个，则此处为0。
			多个同类单元如果显示内容不同，可以在这里进行区分。如果多个设备单元具有完全相同的格式，则此处可以用-1表示允许获取所有同类设备单元的数据，小于-1的值表示同类设备单元的数量
			负的组号提示程序需要对组内多个设备单元进行扫描。	
	显示格式	用于为设备单元选择不同的显示布局，0表示简单列表，1表示矩阵表格
	显示宽度	用于指定多个设备单元同时展示时本设备单元占用的界面宽度系数
	组数量字段名	指定同类设备单元的数量在其它数据包中的字段名称，该字段名称与下一节中的数据项的定义的字段名对应
	背景图片(或颜色)	给每个设备单元指定一幅背景图片或者指定一种背景颜色。6位16进制数表示背景颜色，以H结尾。其它形式的字符串被解释为背景图片的文件名。
	支持分组的命令	依次列出所有支持分组号的命令的CID2编码，每个编码用两位16进制字符表示
	各命令组号	支持组号的命令所使用的组号，FFH表示采用-1作为组，即针对所有同类设备单元发出命令
4、数据项定义
	第四节为数据项定义，按照顺序定义每一个设备单元中的每一个数据项。
	数据项定义每行定义一个数据项，每个数据项定义包括以下用逗号分隔的字段：
	单元	本数据项所属的设备单元编码
	名称	数据项的名称，即数据字段名
	标题	用于显示的数据项标题，采用显示字符串格式
	命令码	十六进制的命令码组合，包括协议格式中定义的所有命令码字段的值。根据不同的协议格式，命令码的长度可能不同。
	值类型	数据项的值类型，包括如下取值：
			1	动态模拟量，表示一个实时的物理量值，通常为一个有限位小数，采用32位单精度浮点数格式或者8到32位整数表示
			2	动态状态量，表示多个实时状态中的一个，通常为一个有限的整数，一般为单字节枚举值，可以引用枚举值定义小节中的定义
			3	时间或时长，表示某个具体的真实时间点，或者一段时间长度。时间用7个字节表示，依次为世纪、年、月、日、时、分、秒。
				也可以省去高位的年等字段，用来表示重复的时点如每一天的某个时点或者每个小时的某个具体时点。
				时长用单个字节表示，此时时长单位在单位字符串字段定义。
			4	字符串，表示一段可显示文本，采用下位机的字符编码。
			5	版本号。由多个字节构成，第一个字节为主版本号，第二个字节为此版本号。每个字节单独解释为一个值，可以按照单位字段的定义来显示。
			6	告警限值。用于表示某种告警的判断条件，可读写。如电压过高告警值等。表示格式与模拟量相同。若该字段名称的开头与某个模拟量的字段名相同，则可提示与该模拟量相关，可以在界面中进行关联显示。
			7	告警状态。与状态量采用相同表示形式。其字段名开头与某模拟量字段名相同，则可在界面中进行关联显示。
			9	定义一个遥控命令。
			10	数量。用于表示数据包中相同数据项的重复数量或者相同结构的数据结构的重复数量。
			11	表示序列号。用多个字节表示，可以将序列号中的每一位表示为一个ASCII字符，也可以用一个字节表示序列号中的相邻两个16进制字符或者BCD码，具体由单位字段定义。
			12	占位字段。用于表示数据包中暂不使用或不予解释的字段。只规定长度，其它定义字段无意义。
			13	记录时间。用于表示历史记录中每条记录的记录时间。
			14	记录数据。用于表示历史记录中的数据项。
			15	告警事件。用于定义告警事件。
			16	时刻表。用于定义一个24小时重复的时刻表，支持将每天24小时划分为最多12个时段，第一个时段的开始为凌晨零时，最后一个时段结束于午夜24时。
				不足12个时段，则后面没有用到的时段的开始时间设置为24:00。每个时段只定义开始时间，其结束时间即为下一时段的开始时间。两个字节分别表示时和分。
				该字段长度为36个字节，首两字节为时刻表生效日期，第3至24字节为第2至12时段开始时刻，第25至36字节依次为12个时段的时段选项值。
			17	历史运行数据记录的时间
			18	历史运行数据记录的数据项
	单位文本	用于表示模拟量、告警限值、参数等的单位字符串，该字符串将会与这些数据一同显示。
				对于状态量和告警状态，用于表示枚举值。可以通过枚举值代号直接引用枚举值定义中的枚举值，也可以直接在这里定义一个新的枚举值。
				对于时间量，用于定义时间的表示格式。每个字符表示时间字段中的一个字节，Y表示年、M表示月、D表示日、H表示小时、N表示分钟、S表示秒。
				对于版本号，用于定义版本号的显示格式
	系数	用于表示模拟量、告警限值、参数等的转换系数。
		当采用定点小数格式时，数值实际上采用整数表示，该整数乘以这个系数可以获得其实际值。常用的系数为0.1和0.01，分别表示该值包含一位和两位小数。
		系数为0表示该项值采用浮点数表示，不需要进行转换。正表示无符号数，负表示有符号数。
	字节长度	用于表示数据项在数据包中的字节长度。
	组数据类	用于表示成组数据的结构。通常包含成组数据的序号和组标题，显示时可以将该字符串转为实际前缀放在数据项的前面。
	重复项数	用于表示一个数据项连续重复出现的数量。用于数量项时，表示该数量项将作用于此后的几个数据项。
		-1代表重复数不确定，由数据包中的某项计数类的数据项值决定。
		如果重复数的值取自本数据项之前的一个数据项，那么，重复数处用0表示。
	公共数据类型	用于定义该数据项是否出现在界面的首页中并绘制历史曲线。-1表示不显示在首页，0或正值表示显示在首页，且将该值相同的项合并显示。
	写命令	表示可写参数的写命令代码
	写位置	表示可写参数的写命令中，该数据项出现的位置，从0开始按字节计算位置。
	命令数列差	对于成组的可写参数，该字段定义了写命令中的编号项的增量。
